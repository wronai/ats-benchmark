{
  "tool": "code2logic",
  "target_project": "/project",
  "tokens_in": 223224,
  "tokens_out": 2265,
  "duration_analysis_sec": 10.469593524932861,
  "duration_llm_sec": 146.21348071098328,
  "duration_total_sec": 156.68744683265686,
  "context_chars": 678039,
  "raw_code_chars": 2790515,
  "compression_ratio": 0.7570201199420179,
  "llm_response": " Based on the AST and function logic provided, here is a comprehensive code review identifying critical issues across the codebase:\n\n## 1. Security Concerns (Critical)\n\n### **SQL Injection Vulnerability**\n- **Function**: `unsafe_sql_lookup` (appears in all app/*.py files: config.py, db.py, orders.py, etc.)\n- **Issue**: The function accepts `user_input:str` and calls `conn.execute` directly without parameterization or sanitization.\n- **Risk**: Direct SQL injection allowing arbitrary query execution.\n- **Fix**: Use parameterized queries: `conn.execute(\"SELECT * FROM ? WHERE id = ?\", (table, user_input))`\n\n### **Arbitrary Code Execution**\n- **Function**: `insecure_eval` (lines 26-28, all modules)\n- **Issue**: Uses `eval(expression)` on unsanitized string input.\n- **Risk**: Remote code execution vulnerability.\n- **Fix**: Replace with `ast.literal_eval` for safe evaluation or use a restricted parser.\n\n### **Mutable Default Argument Security Risk**\n- **Functions**: `accumulate`, all `generated_rule_*` functions (0-219), `async_fetch_with_blocking_sleep`\n- **Issue**: Uses mutable defaults like `acc:list[int]=[]` and `cache:dict[str,Any]={}`.\n- **Risk**: State leakage between calls; cache poisoning; data exposure between requests.\n- **Fix**: Use `None` as default and initialize inside function.\n\n## 2. Logic Errors & Bugs\n\n### **Division by Zero**\n- **Function**: `broken_average` (lines 51-53, all modules)\n- **Issue**: Returns `sum(values) / len(values)` without checking for empty list.\n- **Fix**: Add guard: `if not values: return 0.0` or raise `ValueError`.\n\n### **Async/Blocking Mismatch**\n- **Function**: `async_fetch_with_blocking_sleep` (lines 37-41)\n- **Issue**: Async function calls `time.sleep` (blocking) alongside `asyncio.sleep`.\n- **Impact**: Blocks the event loop, defeating the purpose of async.\n- **Fix**: Remove `time.sleep` or use `await asyncio.sleep()` exclusively.\n\n### **Race Condition in Threading**\n- **Function**: `non_atomic_increment` (lines 72-86)\n- **Issu...",
  "llm_quality_keywords": 21,
  "error": null,
  "metadata": {
    "parser": "tree-sitter",
    "format": "compact+function_logic"
  }
}